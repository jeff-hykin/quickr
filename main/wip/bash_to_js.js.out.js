import { makeShell, $, and, or } from "data:text/javascript;base64,YXN5bmMgZnVuY3Rpb24gc2V0dXAoKSB7CiAgICBjb25zdCAkID0gKGF3YWl0IGltcG9ydCgiaHR0cHM6Ly9kZW5vLmxhbmQveC9kYXhAMC4zOS4yL21vZC50cyIpKS5kZWZhdWx0CiAgICBjb25zdCB7IEZpbGVTeXN0ZW0gfSA9IChhd2FpdCBpbXBvcnQoImh0dHBzOi8vZGVuby5sYW5kL3gvcXVpY2tyQDAuNi43Mi9tYWluL2ZpbGVfc3lzdGVtLmpzIikpCiAgICBjb25zdCAkJCA9ICguLi5hcmdzKT0+JCguLi5hcmdzKS5ub1Rocm93KCkKICAgIGNvbnN0IHJlc2VydmVkQ2hhck1hcCA9IHsKICAgICAgICAiJiI6ICJcXFxceDI2IiwKICAgICAgICAiISI6ICJcXFxceDIxIiwKICAgICAgICAiIyI6ICJcXFxceDIzIiwKICAgICAgICAiJCI6ICJcXFxcJCIsCiAgICAgICAgIiUiOiAiXFxcXHgyNSIsCiAgICAgICAgIioiOiAiXFxcXCoiLAogICAgICAgICIrIjogIlxcXFwrIiwKICAgICAgICAiLCI6ICJcXFxceDJjIiwKICAgICAgICAiLiI6ICJcXFxcLiIsCiAgICAgICAgIjoiOiAiXFxcXHgzYSIsCiAgICAgICAgIjsiOiAiXFxcXHgzYiIsCiAgICAgICAgIjwiOiAiXFxcXHgzYyIsCiAgICAgICAgIj0iOiAiXFxcXHgzZCIsCiAgICAgICAgIj4iOiAiXFxcXHgzZSIsCiAgICAgICAgIj8iOiAiXFxcXD8iLAogICAgICAgICJAIjogIlxcXFx4NDAiLAogICAgICAgICJeIjogIlxcXFxeIiwKICAgICAgICAiXGAiOiAiXFxcXHg2MCIsCiAgICAgICAgIn4iOiAiXFxcXHg3ZSIsCiAgICAgICAgIigiOiAiXFxcXCgiLAogICAgICAgICIpIjogIlxcXFwpIiwKICAgICAgICAiWyI6ICJcXFxcWyIsCiAgICAgICAgIl0iOiAiXFxcXF0iLAogICAgICAgICJ7IjogIlxcXFx7IiwKICAgICAgICAifSI6ICJcXFxcfSIsCiAgICAgICAgIi8iOiAiXFxcXC8iLAogICAgICAgICItIjogIlxcXFx4MmQiLAogICAgICAgICJcXFxcIjogIlxcXFxcXFxcIiwKICAgICAgICAifCI6ICJcXFxcfCIsCiAgICB9CgogICAgY29uc3QgUlhfUkVHRVhQX0VTQ0FQRSA9IG5ldyBSZWdFeHAoCiAgICAgICAgYFske09iamVjdC52YWx1ZXMocmVzZXJ2ZWRDaGFyTWFwKS5qb2luKCIiKX1dYCwKICAgICAgICAiZyIsCiAgICApCgogICAgCgogICAgZnVuY3Rpb24gZXNjYXBlUmVnZXhNYXRjaChzdHIpIHsKICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2VBbGwoCiAgICAgICAgICAgIFJYX1JFR0VYUF9FU0NBUEUsCiAgICAgICAgICAgIChtKSA9PiByZXNlcnZlZENoYXJNYXBbbV0sCiAgICAgICAgKQogICAgfQogICAgCiAgICB2YXIgX2VudlNoaW0gPSB7fQogICAgdmFyIERlbm8gPSBnbG9iYWxUaGlzLkRlbm98fHsKICAgICAgICBwaWQ6MSwKICAgICAgICBlbnY6IHsKICAgICAgICAgICAgdG9PYmplY3QoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX2VudlNoaW0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0KGtleSkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9lbnZTaGltW2tleV0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0KGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIF9lbnZTaGltW2tleV0gPSB2YWx1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWxldGUoa2V5KSB7CiAgICAgICAgICAgICAgICBkZWxldGUgX2VudlNoaW1ba2V5XQogICAgICAgICAgICB9LAogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gbWFrZVNoZWxsKHsKICAgICAgICBhcmdzPVtdLAogICAgICAgIHN0ZGluPURlbm8uc3RkaW4sCiAgICAgICAgc3Rkb3V0PURlbm8uc3Rkb3V0LAogICAgICAgIHN0ZGVycj1EZW5vLnN0ZGVyciwKICAgICAgICBlbnY9ey4uLkRlbm8uZW52LnRvT2JqZWN0KCl9LAogICAgICAgIGV4cG9ydGVkRW52TmFtZXM9bnVsbCwKICAgICAgICBwaWQ9RGVuby5waWQsCiAgICAgICAgcGlkT2ZMYXN0UHJvY2Vzcz1EZW5vLnBpZC0xLAogICAgICAgIGxhc3RTdGF0dXM9ewogICAgICAgICAgICBjb2RlOiAwLAogICAgICAgICAgICBzaWduYWw6IDAsCiAgICAgICAgfSwKICAgICAgICBzb3VyY2UsCiAgICB9PXt9KSB7CiAgICAgICAgY29uc3QgaW5pdGlhbCA9IHsKICAgICAgICAgICAgc3RkaW4sCiAgICAgICAgICAgIHN0ZG91dCwKICAgICAgICAgICAgc3RkZXJyLAogICAgICAgICAgICBwaWQsCiAgICAgICAgICAgIHBpZE9mTGFzdFByb2Nlc3MsCiAgICAgICAgICAgIGxhc3RTdGF0dXMsIC8vIEZJWE1FOiBhcyBvZiB3cml0aW5nLCB0aGlzIHZhciBuZXZlciBnZXRzIHVwZGF0ZWQKICAgICAgICAgICAgam9iczogW10sCiAgICAgICAgICAgIGFsaWFzZXM6IHt9LAogICAgICAgICAgICBmdW5jdGlvbnM6IHt9LAogICAgICAgICAgICBzaGVsbE9wdHM6ICJoaW1CSCIsCiAgICAgICAgICAgIHNob3B0T3B0czogewogICAgICAgICAgICAgICAgImNkYWJsZV92YXJzIjogICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAiY2RzcGVsbCI6ICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICJjaGVja2hhc2giOiAgICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgImNoZWNrd2luc2l6ZSI6ICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAiY21kaGlzdCI6ICAgICAgICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgImNvbXBhdDMxIjogICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAiZG90Z2xvYiI6ICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICJleGVjZmFpbCI6ICAgICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgImV4cGFuZF9hbGlhc2VzIjogICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgICAgICJleHRkZWJ1ZyI6ICAgICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgImV4dGdsb2IiOiAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAiZXh0cXVvdGUiOiAgICAgICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgImZhaWxnbG9iIjogICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAiZm9yY2VfZmlnbm9yZSI6ICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgImdudV9lcnJmbXQiOiAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAiaGlzdGFwcGVuZCI6ICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICJoaXN0cmVlZGl0IjogICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgImhpc3R2ZXJpZnkiOiAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAiaG9zdGNvbXBsZXRlIjogICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgImh1cG9uZXhpdCI6ICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAiaW50ZXJhY3RpdmVfY29tbWVudHMiOiAgICB0cnVlLAogICAgICAgICAgICAgICAgImxpdGhpc3QiOiAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAibG9naW5fc2hlbGwiOiAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICJtYWlsd2FybiI6ICAgICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgIm5vX2VtcHR5X2NtZF9jb21wbGV0aW9uIjogZmFsc2UsCiAgICAgICAgICAgICAgICAibm9jYXNlZ2xvYiI6ICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICJub2Nhc2VtYXRjaCI6ICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgIm51bGxnbG9iIjogICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAicHJvZ2NvbXAiOiAgICAgICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgInByb21wdHZhcnMiOiAgICAgICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgICAgICJyZXN0cmljdGVkX3NoZWxsIjogICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgInNoaWZ0X3ZlcmJvc2UiOiAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAic291cmNlcGF0aCI6ICAgICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgInhwZ19lY2hvIjogICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGV4cG9ydGVkRW52TmFtZXM6IG5ldyBTZXQoWy4uLmV4cG9ydGVkRW52TmFtZXN8fFtdXSksCiAgICAgICAgICAgIGVudjogewogICAgICAgICAgICAgICAgIiQiOiBwaWQsCiAgICAgICAgICAgICAgICAvLyBwb3NzaWJsZSBUT0RPOiBjaGFuZ2UgdGhpcyBwYXRoIHRvIGJlIHRoZSBwYXRoIG9mIHRoZSBjYWxsZXIsIG5vdCB0aGUgcGF0aCB0byB3aGVyZSB0aGlzIGNvZGUgaXMKICAgICAgICAgICAgICAgICIwIjogc291cmNlfHxGaWxlU3lzdGVtLnRoaXNGaWxlLCAvLyBkZWNvZGVVUklDb21wb25lbnQobmV3IFVSTChpbXBvcnQubWV0YS51cmwpLnBhdGhuYW1lLnJlcGxhY2UoLyUoPyFbMC05QS1GYS1mXXsyfSkvZywgIiUyNSIpKSwgLy9UT0RPOiBjaGVjayB0aGF0IHRoaXMgcmVwbGFjZSBpcyBzdGlsbCBuZWVkZWQKICAgICAgICAgICAgICAgICJTSExWTCI6IGVudlsiU0hMVkwiXSB8fCAiMCIsCiAgICAgICAgICAgICAgICAuLi5lbnYsCiAgICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICAgIGNvbnN0IGNyZWF0ZVNjb3BlID0gKHByZXZTY29wZSwgbmV3QXJncyk9PnsKICAgICAgICAgICAgY29uc3Qgc2NvcGUgPSB7CiAgICAgICAgICAgICAgICBhcmdzOiBuZXdBcmdzLAogICAgICAgICAgICAgICAgZW52OiB7fSwKICAgICAgICAgICAgICAgIF9sb2NhbEVudk9iajoge30sCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG5ld0FyZ3MgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gbm8gY29weSBiZWNhdXNlIHNoaWZ0IHdvdWxkIGFmZmVjdCBib3RoCiAgICAgICAgICAgICAgICAvLyBUT0RPOiBjaGVjayBpZiB0aGlzXiBpcyBhbHdheXMgcmlnaHQKICAgICAgICAgICAgICAgIHNjb3BlLmFyZ3MgPSBwcmV2U2NvcGU/LmFyZ3MKICAgICAgICAgICAgfQogICAgICAgICAgICBzY29wZS5lbnYgPSBuZXcgUHJveHkoc2NvcGUuX2xvY2FsRW52T2JqLCB7CiAgICAgICAgICAgICAgICAvLyBvd25LZXlzKHRhcmdldCwgLi4uYXJncykgewogICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiBSZWZsZWN0Lm93bktleXModGFyZ2V0LCAuLi5hcmdzKSAKICAgICAgICAgICAgICAgIC8vIH0sCiAgICAgICAgICAgICAgICBnZXQob3JpZ2luYWwsIGtleSwgLi4uYXJncykgewogICAgICAgICAgICAgICAgICAgIC8vIE51bWJlcmVkIGFyZ3MKICAgICAgICAgICAgICAgICAgICBpZiAoa2V5LTA+MCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuYXJnc1trZXldfHwiIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBzcGVjaWFscwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIkAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLmFyZ3MKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiJiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7c2hlbGwucGlkT2ZMYXN0UHJvY2Vzc31gCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIi0iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNoZWxsLnNoZWxsT3B0cwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICI/IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgJHtzaGVsbC5sYXN0U3RhdHVzPy5jb2RlfHwwfWAKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiISI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7c2hlbGwubGFzdFN0YXR1cz8uc2lnbmFsfHwwfWAKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiIyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7c2NvcGUuYXJncy5sZW5ndGh9YAogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICIqIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS5hcmdzLmpvaW4oIiAiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBncmFiIGxvY2FsIG9uZSBmaXJzdAogICAgICAgICAgICAgICAgICAgIGlmIChSZWZsZWN0LmhhcyhvcmlnaW5hbCwga2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVmbGVjdC5nZXQob3JpZ2luYWwsIGtleSwgLi4uYXJncykKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVmbGVjdC5nZXQocHJldlNjb3BlPy5lbnZ8fHt9LCBrZXksIC4uLmFyZ3MpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldChvcmlnaW5hbCwga2V5LCAuLi5hcmdzKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgbG9jYWwgZXhpc3RzLCBvciBleHRlcm5hbCBvbmUgZG9lc250LCB0aGVuIHNldCBsb2NhbAogICAgICAgICAgICAgICAgICAgIGlmIChSZWZsZWN0LmhhcyhvcmlnaW5hbCwga2V5KSB8fCAhUmVmbGVjdC5oYXMocHJldlNjb3BlPy5lbnZ8fHt9LCBrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWZsZWN0LnNldChvcmlnaW5hbCwga2V5LCAuLi5hcmdzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UsIHNldCBleHRlcm5hbAogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWZsZWN0LnNldChwcmV2U2NvcGU/LmVudnx8e30sIGtleSwgLi4uYXJncykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAvLyBoYXM6IFJlZmxlY3QuaGFzLAogICAgICAgICAgICAgICAgLy8gZGVsZXRlUHJvcGVydHk6IFJlZmxlY3QuZGVsZXRlUHJvcGVydHksCiAgICAgICAgICAgICAgICAvLyBpc0V4dGVuc2libGU6IFJlZmxlY3QuaXNFeHRlbnNpYmxlLAogICAgICAgICAgICAgICAgLy8gcHJldmVudEV4dGVuc2lvbnM6IFJlZmxlY3QucHJldmVudEV4dGVuc2lvbnMsCiAgICAgICAgICAgICAgICAvLyBzZXRQcm90b3R5cGVPZjogUmVmbGVjdC5zZXRQcm90b3R5cGVPZiwKICAgICAgICAgICAgICAgIC8vIGRlZmluZVByb3BlcnR5OiBSZWZsZWN0LmRlZmluZVByb3BlcnR5LAogICAgICAgICAgICAgICAgLy8gZ2V0UHJvdG90eXBlT2Y6IFJlZmxlY3QuZ2V0UHJvdG90eXBlT2YsCiAgICAgICAgICAgICAgICAvLyBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6IFJlZmxlY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLAogICAgICAgICAgICB9KQoKICAgICAgICAgICAgcmV0dXJuIHNjb3BlCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHNoZWxsID0gewogICAgICAgICAgICAuLi5pbml0aWFsLAogICAgICAgICAgICBfc2NvcGVTdGFjazogWwogICAgICAgICAgICAgICAgY3JlYXRlU2NvcGUobnVsbCwgYXJncyksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGdldCBleHBvcnRlZEVudigpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHZhcnMgPSB7fQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBlYWNoIG9mIHNoZWxsLmV4cG9ydGVkRW52TmFtZXMpIHsKICAgICAgICAgICAgICAgICAgICB2YXJzW2VhY2hdID0gc2hlbGwuZW52W2VhY2hdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdmFycwogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBlbnYKICAgICAgICAgICAgZ2V0IGVudigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzaGVsbC5fc2NvcGVTdGFjay5zbGljZSgtMSlbMF0uZW52CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIEZJWE1FOiByZXdvcmsgZXZlcnl0aGluZyB3aXRoIGNvbnNpZGVyYXRpb24gZm9yIGFycmF5cwogICAgICAgICAgICBnZXRWYXIobmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXNTdHJpbmcodGhpcy5lbnZbbmFtZV0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNwbGl0KHZhbHVlKSB7CiAgICAgICAgICAgICAgICAvLyBGSVhNRTogdGhlIHNwbGl0IG1pZ2h0IG5lZWQgdG8gaGF2ZSBhIGR5bmFtaWMgc3BsaXQgY2hhcmFjdGVyIChpbnN0ZWFkIG9mIGFsd2F5cyBiZWluZyAvXHMrL2cpCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hc1N0cmluZyh2YWx1ZSkuc3BsaXQoL1xzKy9nKS5maWx0ZXIoZWFjaD0+ZWFjaCE9IiIpCiAgICAgICAgICAgICAgICAvLyBOT1RFOiB0aGUgZmlsdGVyaW5nIG9mIGVtcHR5IHN0cmluZ3Mgc2VlbXMgdG8gbWF0Y2ggYmFzaCBiZWhhdmlvcgogICAgICAgICAgICAgICAgLy8gICAgICAgYnV0IEknbSBub3Qgc3VyZSBhYm91dCB0aGUgc3BlYwogICAgICAgICAgICAgICAgLy8gaXQgSVMgYSBub3RhYmxlIGVkZ2VjYXNlLCBzaW5jZSBpdCBtYWtlcyBlbXB0eSBhcmdzIGltcG9zc2libGUgc29tZXRpbWVzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFzU3RyaW5nKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS5qb2luKCIgIikKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhgdmFsdWU6YCwgdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoYHNoZWxsLmFzU3RyaW5nKCkgZ290IGEgd2VpcmQgdmFsdWU6ICR7dHlwZW9mIHZhbHVlfSwgJHt2YWx1ZX1gLCB2YWx1ZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYXN5bmMgYXJnRXhwYW5zaW9uUGFzcyhhcmcpIHsKICAgICAgICAgICAgICAgIC8vIE5PVEU6IHRoaXMgc29tZXRpbWVzIHJldHVybnMgYW4gYXJyYXksIGFuZCBzb21ldGltZXMgYSBzdHJpbmcKICAgICAgICAgICAgICAgIC8vIHRoaXMgbmVlZHMgdG8gaGFuZGxlICR7dmFyTmFtZSNhfSBhbmQgKiovKiwgfiwgZXRjIGJhc2VkIG9uIHNoZWxsLnNoZWxsT3B0cwogICAgICAgICAgICAgICAgLy8gTk9URTogJHtAOjF9IGFuZCAkeyo6MX0gYXJlIGJvdGggdHJlYXRlZCBsaWtlIGFycmF5cywgbm90IHN0cmluZ3MKICAgICAgICAgICAgICAgIHJldHVybiBhcmcKICAgICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3Qgb3ZlcnJpZGFibGVCdWlsdGlucyA9IHsKICAgICAgICAgICAgImhlbHAiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJidWlsdGluIjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAiYWxpYXMiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICIuIjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAiYmluZCI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgImNvbW1hbmQiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJjb21wbGV0ZSI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgImRlY2xhcmUiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJkaXNvd24iOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJlbmFibGUiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJleGVjIjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAiZXhwb3J0IjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAiZmMiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJoYXNoIjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAiaGlzdG9yeSI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgImpvYnMiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJsZXQiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJsb2dvdXQiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJwcmludGYiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJwd2QiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJyZWFkb25seSI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgInNoaWZ0IjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAic291cmNlIjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAidGVzdCI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgInRpbWVzIjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAidHJ1ZSI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgInR5cGVzZXQiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJ1bWFzayI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgInVuc2V0IjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAiOiI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgImJnIjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAiYnJlYWsiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJjYWxsZXIiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJjZCI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgImNvbXBnZW4iOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJjb250aW51ZSI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgImRpcnMiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJlY2hvIjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAiZXZhbCI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgImV4aXQiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJmYWxzZSI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgImZnIjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAiZ2V0b3B0cyI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgImtpbGwiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJsb2NhbCI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgInBvcGQiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJwdXNoZCI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgInJlYWQiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJyZXR1cm4iOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJzZXQiOiAoKT0+ewogICAgICAgICAgICAgICAgLypGSVhNRSovCiAgICAgICAgICAgICAgICAvLyB0aGlzIGNhbiBjaGFuZ2UgYWxsIHRoZSBhcmd1bWVudHMgZm9yICRACiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJzaG9wdCI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgInN1c3BlbmQiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJ0cmFwIjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgICAgICAidHlwZSI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgInVsaW1pdCI6ICgpPT57LypGSVhNRSovfSwKICAgICAgICAgICAgInVuYWxpYXMiOiAoKT0+ey8qRklYTUUqL30sCiAgICAgICAgICAgICJ3YWl0IjogKCk9PnsvKkZJWE1FKi99LAogICAgICAgIH0KICAgICAgICBjb25zdCBjYW5ub3RCZUZ1bmN0aW9uTmFtZXMgPSB7CiAgICAgICAgICAgICJpZiI6ICgpPT57IC8qRklYTUUqLyB9LAogICAgICAgICAgICAiZm9yIjogKCk9PnsgLypGSVhNRSovIH0sCiAgICAgICAgICAgICJjYXNlIjogKCk9PnsgLypGSVhNRSovIH0sCiAgICAgICAgICAgICJmdW5jdGlvbiI6ICgpPT57IC8qRklYTUUqLyB9LAogICAgICAgICAgICAic2VsZWN0IjogKCk9PnsgLypGSVhNRSovIH0sCiAgICAgICAgICAgICJ3aGlsZSI6ICgpPT57IC8qRklYTUUqLyB9LAogICAgICAgICAgICAiW1siOiAoKT0+eyAvKkZJWE1FKi8gfSwKICAgICAgICAgICAgInRpbWUiOiAoKT0+eyAvKkZJWE1FKi8gfSwKICAgICAgICAgICAgInVudGlsIjogKCk9PnsgLypGSVhNRSovIH0sCiAgICAgICAgfQogICAgICAgIGNvbnN0IGNhbm5vdEJlQWxpYXNPckZ1bmN0aW9uTmFtZSA9IHsKICAgICAgICAgICAgIigoIjogKCk9PnsgLypGSVhNRSovIH0sCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBzaGVsbAogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgbWFrZVNoZWxsLAogICAgICAgICQ6ICQkLAogICAgICAgIGFuZDogKGNvbW1hbmQpPT4ocmVzdWx0KT0+cmVzdWx0LmNvZGU9PTAgJiYgY29tbWFuZCgpLAogICAgICAgIG9yOiAoY29tbWFuZCk9PihyZXN1bHQpPT5yZXN1bHQuY29kZT09MCB8fCBjb21tYW5kKCksCiAgICB9Cn0KZXhwb3J0IGNvbnN0IHttYWtlU2hlbGwsICR9ID0gYXdhaXQgc2V0dXAoKQ=="
const shell = makeShell()

await $`echo hi6`.env({ ...shell.exportedEnv, "VAR1": `10`, "VAR2": shell.getVar("VAR2")+`11`, })
await $`echo hi`
await $`echo hi > hi.txt`
await $`echo hi`.then(and(()=>
    $`echo bye`
))
